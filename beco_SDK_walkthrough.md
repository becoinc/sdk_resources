![](https://beco.io/wp-content/themes/beco.io/assets/img/beco_logoblue@2x.png)


# **BECO MOBILE SDK WALKTHROUGH**

This guide is intended to supplement the iOS and Android™ specific SDK User Guides, available on our public GitHub. Here, we will take you through all the key features and functions of our SDK to ensure the smoothest and most efficient integration experience possible. Please be sure to read this guide, along with the SDK User Guides, in their entirety before beginning development work as they contain information crucial to successful integration.

Additional resources are available at our online developer site [dev.beco.io](https://dev.beco.io/docs).

>**Questions?**

>[support@beco.io](support@beco.io)

#### License
This document, the Beco SDK for iOS and Android, the Beco Cordova SDK, and the included sample applications are subject to the Beco SDK license agreement. A reference copy is included in the [LICENSE.md](./LICENSE.md) file. The *governing copy* of this agreement is available at [https://www.beco.io/files/sdk-license-agreement.pdf](https://www.beco.io/files/sdk-license-agreement.pdf).

## **CONTENTS**
##### SDK Overview
1. Core
2. Event Callback Functions
3. Advanced Performance Settings
4. Utility / Information Functions

##### Using the SDK
1. Initialization and Setup
2. Registering Handset
3. Registering Event Callbacks
4. Start/Stop Scan
5. Adjusting Advanced Performance Settings
6. Utility / Information Functions

##### Nuances
1. Simulator Usage
2. Bluetooth Status
3. Long-Term Analytics

##### Example Apps

##### Legal
1. Export Statement
2. Trademark Notes


## **SDK OVERVIEW**
This section outlines the core functions of the Beco Mobile SDK. Specific usage and details of the individual functions overviewed here is covered in the next section: “Using the SDK."

[**NOTE**]: Many of the SDK’s functions operate asynchronously in the background thread. Because of this, they do not return data directly and instead use callback functions in similar format to many other JS frameworks. See subsection "Registering Event Callbacks" under the next section "Using the SDK."

#### Core

Used to initialize the SDK, configure and authorize SDK credentials and handset metadata, and start/stop the beacon detection system.

```javascript
var sdk : BecoSDKInterface    
sdk = BecoSDKInterface()

sdk.hostname = "api.beco.io" // If Beco has provided you with another hostname, use it here.
sdk.setCredentials( "SDKusername", "SDKpassword" )

let registrationSuccess
    = self.sdk.registerHandset( nil,
                                personId: // can be nil
                                groupId: // can be nil
                                userData: // can be nil; a dictionary--see documentation
                                completion: self.registerHandsetCallback ) //callback function
if registrationSuccess
{
    print( "Registered Handset." )
}
```

We must ensure that `startScan` is called after `registerHandset`.  
Because registering the handset is asynchronous, we place `startScan` into the callback of `registerHandset`, `registerHandsetCallback`. `registerHandsetCallback` executes only after the completion of `registerHandset`.

#### Event Callback Functions
Used to register callback functions that will be called periodically in response to events generated by the SDK, including real-time location updates and error reports.

* onReportStartScanComplete
* onReportAppHit **[deprecated]**
* onReceiveLocationData
* onReportError

#### Advanced Performance Settings
Used to view or modify adjustment variables meant to customize the performance of the SDK in very specific circumstances.

[**NOTE**]: The SDK has pre-set default values to ensure reliable indoor positioning performance. The cases where these defaults may need adjustment are extremely rare, and even then should only be modified after review with our Support Team in order to preserve system performance. Open a ticket via [support@beco.io](support@beco.io) if you experience unexpected location performance.

```javascript
print("current Threshold: \(sdk.ThresholdAdjustment)")
//set new Threshold
sdk.thresholdAdjustment = newThres;
print("current Refresh Interval: \(sdk.refreshInterval)")
//set new Refresh Interval
sdk.refreshInterval = newRefresh;
```

#### Utility / Information Functions
Used to get various information from the SDK.

* getVersion
* getPlatformVersion
* getHSID

## **USING THE SDK**
The following is a detailed breakdown of each individual function of the Beco Mobile SDK, presented in the appropriate code flow order of operations.

#### Initialization and Setup
Before using any other functionality of the SDK, your application must authenticate with the SDK. This is done using `setCredentials`.

>***This should be called at every App startup***

```javascript
sdk.hostname = "api.beco.io" // If Beco has provided you with another hostname, use it here.
sdk.setCredentials( "SDKusername", "SDKpassword" )
```

* `hostname` set to “api.beco.io” to point to the Beco Cloud service. The hostname will only differ if you have a private instance of the Beco Cloud.

* `username` refers to the SDK username that has been provided to you as part of your Beco Developer Credentials. The first part of your Beco Service Account/Mobile SDK Credentials.

* `password` refers to the SDK password that has been provided to you as part of your Beco Developer Credentials. The second part of your Beco Service Account/Mobile SDK Credentials.

[**NOTE**]: The SDK username and SDK password should be hardcoded into your application, as these values are used to authenticate the SDK against your Customer Account and allow the application to decrypt the Beco Beacons in your network. The `registerHandset` function detailed below allows for enhanced spatial analytics with different levels of individual user visibility based on your desired use case.

#### Registering Handset
Next, after the App is first installed by a user, it must register the handset with the SDK. This function configures the handset for location positioning with the SDK.

```javascript
let registrationSuccess
    = self.sdk.registerHandset( nil,
                                personId:  // can be nil
                                groupId:  // can be nil
                                userData: // can be nil; a dictionary--see documentation
                                completion: self.registerHandsetCallback )
if registrationSuccess
{
    print( "Registered Handset." )
}
```

>***It is safe to call this function at every application startup***. If the handset has already been registered, the function will silently skip the handset registration and call the success function.

The following are different values that can be registered with the SDK for each handset. The default, anonymous `handsetID` (HSID) assigned by the SDK is the only value required for the SDK to function. With an approach we call “Customizable Anonymity,” you have the flexibility to register one or both additional inputs beyond `handsetID` (`groupID` and/or `personID`) for enhanced analytics depending on your use case and desired level of analytics. If used, Beco recommends taking steps to anonymize this information to reduce the amount of PII pushed in to the Beco system. See [https://dev.beco.io/docs/privacy-and-system-definitions](https://dev.beco.io/docs/privacy-and-system-definitions) and [https://dev.beco.io/docs/optional-sdk-inputs](https://dev.beco.io/docs/optional-sdk-inputs) for more details.

* `handsetID`: This parameter can be set to null/nil and will be auto generated by the SDK. On iOS, this will be the IDFV for the first 'userName' registered and randomly generated for all others. On Android, this will be a randomly generated string of letters and numbers.

* `personID`: Use to identify each unique user. The personID is a plaintext string and therefore may be defined as most appropriate to your organization, e.g. an employee ID, user ID, or similar internal identifier. It is important that this value stays constant across sessions in order for correct analytics data to be generated. Whatever ID you choose will be searchable via the Occupancy API. If no `personID` is specified, the `handsetID` will be used. See [dev.beco.io](https://dev.beco.io/docs) for more information.

* `groupID`: Use to assign users to an internal group e.g. their department, role, or similar group level identifier. The `groupID` is a string and therefore may be defined as most appropriate to your organization. It is important that this value stays constant across sessions in order for correct analytics data to be generated. See [dev.beco.io](https://dev.beco.io/docs) for more information.

* `userData`: A handset can have arbitrary user provided (JSON) data attached to it. This data can be added or modified using our PATCH endpoint and retrieved later using the Beco Web API endpoints. If this is not relevant, null/nil is an acceptable answer. One kilobyte worth of data is the current cap.

#### Registering Event Callbacks
The Beco Mobile SDK returns real-time location data using callback functions. The SDK will call the callback functions each time new data is generated for the corresponding event. By using these event callback functions, you can obtain real-time location data from the SDK.

>***It is recommended that you register callback functions before calling `startScan` (next section) so that your application does not miss any events***.

The following events are supported:

Event Name | Callback Setter Function
------------ | -------------
`reportStartScanComplete` | onReportStartScanComplete
`reportAppHit` | onReportAppHit
`receiveLocationData` | onReceiveLocationData
`reportError` | onReportError

These events will now be described individually.

`onReportStartScanComplete`

This event will fire when the SDK has started scanning, and provides a way to diagnose the status of the beacon detection system. The event data will be returned as a JS object, displayed here as JSON:

```JSON
{
    "statusCode" : 0,
    "statusString" : "Status String"
}
```

The following codes may occur:

Status Code | Status String | Description
------------ | ------------- | ------------
0 | Success | The scan for beacons has started successfully.
1 | Unauthorized | The user has not yet authorized the app with the correct credentials.
2 | Bluetooth Off | Bluetooth is turned off. *This event will not fire with the current API version (see “Nuances” section)*.
3 | Bluetooth Unsupported | Bluetooth is unsupported. *This event will not fire with the current API version (see “Nuances” section)*.
4 | Bluetooth Unauthorized | Bluetooth is unauthorized. *This event will not fire with the current API version (see “Nuances” section)*.
5 | Bluetooth Unknown | General error code.
6 | Network Error | The is no cellular or WiFi connection available.
7 | Invalid Credentials | The Mobile SDK Credentials provided are invalid.
8 | Already Scanning | The SDK is already scanning for beacons.

`onReportAppHit` **[DEPRECATED]**

This event will return a Beco Beacon ID corresponding to the beacon closest to the phone’s location. This event is called as soon as the SDK detects a beacon and before its sends the data to the Beco Cloud to obtain more detailed information. This event is deprecated and is currently disabled on Android. To access real-time location hits, please use the `onReceiveLocationData` event.

`onReceiveLocationData`

This event will return real-time location data based on the SDK’s beacon detection. You may get the same location data sent multiple times as a status refresh. When no location data is available, or the location is ambiguous, the event will receive a null/nil object.

The SDK may report an unknown location for one of several reasons:

* You may be out of the reliable range of your registered Beco Beacons.

* The RF environment is such that your location is ambiguous. You are neither here nor there and the SDK is informing you of that situation.

* The phone does not have an available Internet connection and you have changed locations.

The location data will be returned as a JS object, displayed here as JSON:

```JSON
{
    "becoId" : "XXXXXX",
    "hsid" : "XXXXXX",
    "place" : {
        "placeName" : "Place Name",
        "placeId" : "XXXXXX",
        "comments" : null,
        "capacity" : 0,
        "floor" : {
            "name" : "Twelfth Floor",
            "floorId" : 12
        },
        "location" : {
            "locationName" : "Location Name",
            "locationId" : "XXXXXX"
        }
    }
}
```

Many of these fields are editable via the Beco Portal, and would have been set during initial registration (“check-in”) of the beacon in the Beco Setup App during installation. Depending on the configuration of your beacon, some of these fields may be blank.

>If you are using real-time location data in your App, the use of `place.placeID` as an identifier is recommended. Using Beco IDs to determine location is not advised, since multiple beacons can be grouped in to a single Place.

`onReportError`

This event will fire when an SDK error/event has occurred. The error data will be returned as a JS object, displayed here as JSON:

```JSON
{
    "errorCode" : 0,
    "errorString" : "Error String"
}
```

The following errors may occur:

Error Code | Error String | Description
------------ | ------------- | ------------
0 | Credential Mismatch | The Mobile SDK Credentials specified do not match the detected beacon network.
1 | Customer Not Found | The Mobile SDK Credentials specified are not tied to an active customer.
2 | Rate Limit Exceeded | The server has reported a rate limit violation.
3 | Server Communication Failure | The was a problem communicating with the Beco Cloud Servers.
4 | Bluetooth Disabled | Bluetooth has been disabled. *This event will not fire with the current API version (see “Nuances” section)*.
5 | Bluetooth Enabled | Bluetooth has been re-enabled. *This event will not fire with the current API version (see “Nuances” section)*.
6 | Location Disabled | Location Services have been disabled.
7 | Location Enabled | Location Services have been re-enabled.

#### Start/Stop Scanning
To start scanning for Beco Beacons, call the following command:

```javascript
sdk.startScan()
```

The SDK will begin scanning for beacons and will periodically call the registered event callbacks.

>***In order for the SDK to function properly, you should call `startScan` as soon as possible after your app has launched.***

Once you call `startScan`, the SDK will continue to scan for beacons in either the foreground or background (even when the App is swiped closed) until one or more of the following occurs:

* `stopScan` is called.

* The phone restarts (it is device/OS version specific if scanning auto-restarts).

* The user force-stops the app (Android). This is not a swipe-close, it’s an App manager function. The SDK will continue in the background with the App simply swiped closed.

* The OS kills the app due to memory pressure. The OS may restart it once memory is available (device/OS version specific).

The SDK will stay running in the background and wake the phone up when possible to process beacon information when permitted by the OS. The following differences with background behavior have been observed based on the native power saving features of each OS:

**iOS:** The SDK will continue to run in the background indefinitely, and background startup will automatically resume upon device restart and passcode input (if applicable).

**Android:** The SDK will hit in the background for roughly fifteen minutes before the OS prevents the SDK from operating normally. Light user interaction with the device every fifteen minutes will sustain expected background behavior; less frequent interaction will result in inconsistent background behavior over time. This behavior is heavily dependent on OS version.

If you wish to stop scanning for beacons at some point in your App workflow (for example, if the user logs out of your App), that is when you would call `stopScan`.

>It is recommended that you do not call `stopScan` unless the user logs out of the App entirely, you have a geofenced location users will enter and exit, or similar. The SDK has been designed to minimally impact battery life, and continuous scanning for beacons will allow collection of accurate long-term analytics data for the space.

#### Adjusting Advanced Performance Settings
The SDK includes several advanced performance settings to adjust how the positioning algorithm performs.

>*In all cases, open a ticket via [support@beco.io](support@beco.io) before making adjustments to the Beco default values in order to ensure appropriate system performance*.

`ThresholdAdjustment`

This value adjusts the positioning sensitivity of the SDK.

The SDK automatically adjusts to ensure reliable indoor positioning, and is pre-tuned for optimal performance. The Beco default values for iOS and Android should be used in all cases, and will be set automatically by the SDK.

In the rare case an adjusted value is needed, it can be set in the following manner:

```javascript
sdk.thresholdAdjustment = newThres;
```

You can retrieve the current set value for `ThresholdAdjustment` using

```javascript
print("current Threshold: \(sdk.ThresholdAdjustment)")
```

`RefreshInterval` **[DEPRECATED]**

This value determines the interval at which the SDK will scan for beacons and call the event handler function. Given how our SDK has evolved, this adjustment is now deprecated and will not yield any performance enhancement. *The Beco default (10 seconds) should be kept in all cases*.

#### Utility / Information Functions
There are several utility and information functions that can be used to obtain information from the Beco Mobile SDK.

To get the version of the SDK, use the following command:

```javascript
print( "\(BecoSDKInterface.getSDKVersion())" )
```

To get the version of the OS platform (iOS or Android) that the SDK is running on, use the following command:

```javascript
sdk.getPlatformVersion(function(version){
    console.log("Beco SDK Platform Version: "+version);
});
```

The SDK limits its functionality to real-time positioning/occupancy data. Long-term occupancy/utilization data and additional metadata about the user can be retrieved using our APIs, documented at [dev.beco.io](dev.beco.io). APIs can be accessed using a basic Javascript connection to the web endpoints.

To retrieve metadata about an individual handset, it is useful to have access to the `HandsetID` (HSID) generated by the SDK. This value can be accessed by calling the following method:

```javascript
sdk.getHSID(function(hsid){...});
```

## **NUANCES**
This section describes nuances of using the Beco Mobile SDK, and any features of the SDK that are not immediately obvious but are necessary for proper use.

#### Simulator Usage
BLE devices have limited `Core Location` support when in simulation. We’ve found the simulator useful for testing UI code, but not usable for testing the Beco System.

>The SDK will not function correctly inside a simulator, and will not start scanning successfully. The best way to perform testing using the SDK is to use real Beco Beacons and a physical device running the SDK.

#### Bluetooth Status
Since the SDK does not interface with Bluetooth directly, using Bluetooth via the Location Services API, it will not be aware when Bluetooth is disabled. If the application is scanning with Bluetooth disabled, `onReceiveLocationData` will receive a `null` location value representing an unknown location.

It is up to the developer to ensure their UI/UX communicates to the user that Bluetooth be enabled, even though the App itself does not require Bluetooth permissions.

Specifically on iOS, the SDK does not invoke `CBCentralManager` to detect the current phone Bluetooth enabled/disabled state. This is done to minimize user annoyance with OS pop-ups. In certain circumstances iOS will prompt the user to enable Bluetooth for Location services. If SDK customers wish to remind their App users about enabling Bluetooth, then they should invoke `CBCentralManager` as appropriate.

>**No beacons will be detected if Bluetooth is disabled.**

#### Long-Term Analytics
The data sourced by the SDK contributes to long term analytics data for spaces with Beco Beacons installed. This data can be analyzed through the [Beco Portal](https://portal.beco.io/) or plugged in to and digested by any existing internal or third party system currently in use. This analytics data collection is built in to the API and does not require additional configuration.

## **EXAMPLE APPS**
To give you code and UI reference points for the specifics discussed above, we include an Example App for each OS in our SDK packages, as well as our Apache Cordova beta (available for download on our public GitHub). Be sure to take a look at the code implementation to gain an applied understanding of using the SDK.  

## **LEGAL**

#### Export Statement
You understand that the Software may contain cryptographic functions that may be subject to export restrictions, and you represent and warrant that you are not located in a country that is subject to United States export restriction or embargo, including Cuba, Iran, North Korea, Sudan, Syria or the Crimea region, and that you are not on the Department of Commerce list of Denied Persons, Unverified Parties, or affiliated with a Restricted Entity.

You agree to comply with all export, re-export and import restrictions and regulations of the Department of Commerce or other agency or authority of the United States or other applicable countries. You also agree not to transfer, or authorize the transfer of, directly or indirectly, the Software to any prohibited country, including Cuba, Iran, North Korea, Sudan, Syria or the Crimea region, or to any person or organization on or affiliated with the Department of Commerce lists of Denied Persons, Unverified Parties or Restricted Entities, or otherwise in violation of any such restrictions or regulations.

#### Trademark Notes

* IOS is a trademark or registered trademark of Cisco in the U.S. and other countries and is used under license.

* Android is a trademark of Google Inc.
